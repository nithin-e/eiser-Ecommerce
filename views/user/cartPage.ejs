<%- include('Header') %>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
        integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">
    <link rel="stylesheet" href="cart.css">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@200;300;400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

    



  

 

 





    <style>
        :root {
          /* --primary-color: #3498db; */
           --primary-color: #71cd14;
          --secondary-color: #2ecc71;
          --text-color: #333;
          --background-color: #f8f8f8;
          --border-color: #e0e0e0;
          --shadow-color: rgba(0, 0, 0, 0.1);
        }
      
        /* General styles */
        body {
          font-family: 'Roboto', sans-serif;
          font-size: 16px;
          color: var(--text-color);
          background-color: var(--background-color);
          margin: 0;
          padding: 0;
          line-height: 1.6;
        }
      
        /* Container styles */
        #cart_container {
          display: flex;
          justify-content: space-between;
          max-width: 1200px;
          margin: 40px auto;
          padding: 30px;
          background-color: #fff;
          border-radius: 12px;
          box-shadow: 0 6px 12px var(--shadow-color);
        }
      
        /* Product list styles */
        #card {
          flex-grow: 1;
          overflow-y: auto;
          max-height: calc(90vh - 200px);
          padding: 20px;
          background-color: #ffffff;
          border-radius: 8px;
        }
      
        /* Table styles */
        .table {
          width: 100%;
          border-collapse: separate;
          border-spacing: 0 15px;
        }
      
        .table th {
          background-color: var(--primary-color);
          color: #fff;
          padding: 15px;
          text-align: left;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          border-radius: 6px 6px 0 0;
        }
      
        .table td {
          padding: 20px 15px;
          vertical-align: middle;
          background-color: #ffffff;
          transition: all 0.3s ease;
        }
      
        .table tr {
          box-shadow: 0 2px 5px var(--shadow-color);
          border-radius: 8px;
          transition: all 0.3s ease;
        }
      
        .table tr:hover {
          transform: translateY(-3px);
          box-shadow: 0 5px 15px var(--shadow-color);
        }
      
        /* Product image styles */
        .table .media img {
          max-width: 80px;
          max-height: 80px;
          object-fit: cover;
          border-radius: 6px;
          transition: transform 0.3s ease;
        }
      
        .table .media img:hover {
          transform: scale(1.1);
        }
      
        /* Product name styles */
        .table .media-body p {
          margin: 15px;
          font-weight: 500;
          color: var(--text-color);
        }
      
        /* Price and total styles */
        .table h6 {
          margin: 0;
          font-size: 16px;
          font-weight: 600;
          color: var(--primary-color);
        }
      
        /* Quantity controls - New unique style */
        .quantity-container {
          display: flex;
          align-items: center;
          background-color: #f0f0f0;
          border-radius: 20px;
          padding: 5px;
          width: fit-content;
          position: relative;
          overflow: hidden;
          box-shadow: 0 2px 5px var(--shadow-color);
        }
      
        .quantity-container button {
          background-color: var(--primary-color);
          color: white;
          border: none;
          width: 30px;
          height: 30px;
          font-size: 18px;
          cursor: pointer;
          transition: transform 0.3s ease, background-color 0.3s ease;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 50%;
          margin: 0 5px;
        }
      
        .quantity-container button:hover {
          background-color: var(--secondary-color);
        }
      
        .quantity-container button:active {
          transform: scale(0.95);
        }
      
        .quantity-container input[type="number"] {
          width: 40px;
          text-align: center;
          border: none;
          background-color: transparent;
          font-size: 16px;
          font-weight: bold;
          color: var(--text-color);
          -moz-appearance: textfield;
        }
      
        .quantity-container input[type="number"]::-webkit-outer-spin-button,
        .quantity-container input[type="number"]::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
      
        /* Delete icon */
        .delete-link {
          color: #e74c3c;
          cursor: pointer;
          transition: color 0.3s, transform 0.2s;
          font-size: 18px;
        }
      
        .delete-link:hover {
          color: darken(#e74c3c, 10%);
          transform: scale(1.2);
        }
      
        /* Summary container */
        #pay {
          width: 300px;
          background-color: #fff;
          padding: 25px;
          border-radius: 8px;
          box-shadow: 0 4px 10px var(--shadow-color);
          margin-left: 30px;
        }
      
        .summary-container {
          margin-bottom: 25px;
        }
      
        .summary-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 15px;
          padding-bottom: 15px;
          border-bottom: 1px solid var(--border-color);
        }
      
        .summary-item:last-child {
          border-bottom: none;
        }
      
        .summary-label h6,
        .summary-value h6 {
          margin: 0;
          font-size: 16px;
          color: var(--text-color);
        }
      
        .summary-value h6 {
          font-weight: 600;
          color: var(--primary-color);
        }
      
        /* Grand total section */
        .grand_total_section {
          margin-top: 25px;
          text-align: right;
        }
      
        .grand_total_section h6 {
          font-size: 20px;
          font-weight: bold;
          color: var(--primary-color);
        }
      
        /* Buttons */
        .gray_btn {
          display: inline-block;
          background-color: var(--primary-color);
          color: white;
          text-decoration: none;
          transition: all 0.3s ease;
          font-weight: 600;
          text-align: center;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }
      
        /* .gray_btn:hover {
          background-color: darken(var(--primary-color), 10%);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px var(--shadow-color);
        } */
      
        /* Empty cart */
        .empty-cart {
          text-align: center;
          padding: 60px 20px;
          
        }
      
        .empty-cart h2 {
          color: var(--primary-color);
          margin-bottom: 20px;
          font-size: 28px;
        }
      
        .empty-cart p {
          color: var(--text-color);
          margin-bottom: 30px;
          font-size: 18px;
        }
      
        /* Responsive design */
        @media (max-width: 1024px) {
          #cart_container {
            flex-direction: column;
            padding: 20px;
          }
      
          #pay {
            width: 100%;
            margin-top: 30px;
            margin-left: 0;
          }
      
          #card {
            max-height: none;
          }
        }
      
        @media (max-width: 768px) {
          .table,
          .table tbody,
          .table tr,
          .table td {
            display: block;
            width: 100%;
          }
      
          .table thead {
            display: none;
          }
      
          .table tr {
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
          }
      
          .table td {
            text-align: right;
            padding-left: 50%;
            position: relative;
          }
      
          .table td::before {
            content: attr(data-label);
            position: absolute;
            left: 6px;
            width: 45%;
            padding-right: 10px;
            white-space: nowrap;
            font-weight: bold;
            text-align: left;
          }
      
          .quantity-container {
            justify-content: flex-end;
          }
        }
      
        /* Toast and Sweet Alert custom styles */
        .toastify-custom {
          font-size: 14px;
          padding: 12px 20px;
          border-radius: 4px;
          box-shadow: 0 3px 10px var(--shadow-color);
        }
      
        .swal-custom {
          width: 400px !important;
          max-width: 90%;
        }
      
        .swal-custom-content {
          font-size: 16px;
        }
      
        .swal-custom-confirm {
          background-color: var(--primary-color) !important;
        }
      
        .swal2-styled.swal2-confirm,
        .swal2-styled.swal2-cancel {
          font-size: 14px;
          padding: 10px 24px;
          border-radius: 25px;
        }
      
        /* Animations */
        @keyframes fadeIn {
          from {
            opacity: 0;
          }
      
          to {
            opacity: 1;
          }
        }
      
        .table tr {
          animation: fadeIn 0.5s ease-out;
        }
      
        .gray_btn,
        .delete-link,
        .quantity-container button {
          transition: all 0.3s ease;
        }
      
        .gray_btn:active,
        .delete-link:active,
        .quantity-container button:active {
          transform: scale(0.95);
        }
      </style>



<style>
  .quantity-container {
    display: flex;
    align-items: center;
    background-color: #f0f0f0;
    border-radius: 25px;
    padding: 5px;
    width: fit-content;
  }
  
  .quantity-btn {
    background-color: var(--primary-color);
    color: white;
    border: none;
    width: 30px;
    height: 30px;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
  }
  
  .quantity-btn:hover {
    background-color: var(--secondary-color);
  }
  
  .quantity-btn:active {
    transform: scale(0.95);
  }
  
  .quantity-input {
    width: 40px;
    text-align: center;
    border: none;
    background-color: transparent;
    font-size: 16px;
    font-weight: bold;
    color: var(--text-color);
    -moz-appearance: textfield;
    margin: 0 10px;
  }
  
  .quantity-input::-webkit-outer-spin-button,
  .quantity-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  </style>

      
</head>
<body>
    <!--================Home Banner Area =================-->
    <section class="banner_area" style="padding: 10px; margin-top: 70px;border-bottom: 1px solid green;">
        <div class="banner_inner d-flex align-items-center">
          <div class="container">
            <div
              class="banner_content d-md-flex justify-content-between align-items-center"
            >
              <div class="mb-3 mb-md-0">
                <h2>Cart Page</h2>
                <p>Very us move be blessed multiply night</p>
              </div>
              <div class="page_link">
                <a href="index.html">Home</a>
                <a href="checkout.html">Product Checkout</a>
              </div>
            </div>
          </div>
        </div>
      </section>
  <!--================End Home Banner Area =================-->
  <div id="cart_container"   style="border: 2px solid #71cd14 ;">
    <div id="card">
        <div id="product">
           
            <table class="table">
               
                <thead>
                  <tr>
                    <th scope="col">Product</th>
                    <th scope="col">Price</th>
                    <th scope="col">Quantity</th>
                    <th scope="col">Total</th>
                    
                  </tr>
                </thead>
                <tbody>
                  <!-- Product Rows -->
                  <% if (!cartItems || cartItems.length === 0) { %>
                    
                  <tr>
                    <h2 style="font-family: monospace;">Your cart is empty</h2>
                    <p style="font-family: system-ui;font-weight: 600;">Looks like you haven't added anything to your cart yet.</p>
                    <a href="/productPage" class="gray_btn"   style="margin-left: 153px;">Continue Shopping</a >
                  
                </div>
                  <% } else { %>
                  <% cartItems.forEach(item => { %>
                  <% item.cartProducts.forEach(products => { %>
                  <tr id="productRow_<%= products.productId %>">
                    <td>
                      <div class="media">
                        <div class="d-flex">
                          <img src="<%= products.images[0] %>" alt="Product Image" style="max-width: 100px; max-height: 70px; border-radius: 0px 2px;">
                        </div>
                        <div class="media-body">
                          <p><%= products.productName %></p>
                        </div>
                      </div>
                    </td>
                    <td>
                      <h6 style="line-height: 16px;font-size: 12px;">₹<%= products.total %></h6>
                    </td>
                    <!-- <td>
                        <div>
                            <button id="decreaseBtn" data-id="<%= products.productId %>"  onclick="decreaseButton('<%= products.productId %>', '<%= products.quantity %>','<%= products.stockQuantity %>')">-</button>
                            <input type="number" class="quantity-input" id="qty_<%= products.productId %>" value="<%= products.quantity %>" readonly>
                            <button id="increaseBtn" class="btn-plus" data-id="<%= products.productId %>" onclick="updateQuantity('<%= products.productId %>','<%= products.quantity %>', '<%= products.stockQuantity %>')">+</button>
                        </div>                        
                    </td> -->

                    <td>
                      <div class="quantity-container">
                        <button class="quantity-btn minus" onclick="decreaseButton('<%= products.productId %>', '<%= products.quantity %>', '<%= products.stockQuantity %>')">
                          <i class="fas fa-minus"></i>
                        </button>
                        <input type="number" class="quantity-input" id="qty_<%= products.productId %>" value="<%= products.quantity %>" readonly>
                        <button class="quantity-btn plus" onclick="updateQuantity('<%= products.productId %>', '<%= products.quantity %>', '<%= products.stockQuantity %>')">
                          <i class="fas fa-plus"></i>
                        </button>
                      </div>
                    </td>
                    <td>
                      <h6 style="line-height: 16px;font-size: 15px;" id="total_<%= products.productId %>">₹<%= products.total * products.quantity %></h6>
                    </td>
                    <td>
                      <a class="delete-link" onclick="deleteCart('<%= products.productId %>')">
                        <i class="fas fa-trash-alt"></i>
                      </a>
                    </td>
                  </tr>
                  <% }); %>
                  <% }); %>
                  <% } %>
                </tbody>
              </table>
              
        </div>
    </div>
    <% if (!cartItems || cartItems.length === 0) { %>



        <% } else{%>
    <div id="pay" style="height: 50%;">
        <div class="summary-container">
            <% cartItems.forEach(item => { %>
            <% 
              // Calculate subtotal
              const subtotal = item.cartProducts.reduce((acc, product) => acc + (product.total * product.quantity), 0);
            %>
            <div class="summary-item">
                <div class="summary-label">
                    <h6 style="font-size: 15px;">Subtotal</h6>
                </div>
                <div class="summary-value">
                    <h6 style="line-height: 16px;font-size: 15px;" class="subtotalPrice">₹<%= subtotal %></h6>
                </div>
            </div>
            <div class="summary-item no-border">
                <div class="summary-label">
                    <h6 style="font-size: 15px;">Shipping</h6>
                </div>
                <div class="summary-value">
                    <h6 style="line-height: 16px;font-size: 15px;" class="shippingCost">₹100</h6>
                </div>
            </div>

            <div class="summary-item no-border">
                <div class="summary-label">
                    <h6 style="font-size: 15px;">Grand Total</h6>
                </div>
                <div class="summary-value">
                    <h6 style="line-height: 16px;font-size: 15px;" class="grandTotal" id="grandtotal">₹<%= subtotal + 100 %></h6>
                </div>
            </div>
            <% }) %>
        </div>
        <div class="grand_total_section">
            <div class="shipping_box" style="margin-left: 30px;">
                <a class="gray_btn" href="/CheckOutPage">checkout</a>
            </div>
        </div>
        
    </div>
    <% } %>
</div>


 <!-- couponMOdal -->
 
 
<!-- end of edit modal -->




<style>
    .swal-custom {
        width: 400px !important;
        height: auto !important; 
        max-width: 80%; 
    }
    .swal-custom-content {
        text-align: center; 
        font-size: 11px; 
    }
    .swal-custom-confirm {
        background-color: #3085d6; 
        color: white; 
    }
    .swal2-styled.swal2-confirm{
        width: 123px;
        padding: 5px;
    }
    .swal2-styled.swal2-cancel{
        width: 85px;
        padding: 5px;
    }
</style>




<style>
    .toastify-custom {
        font-size: 12px; 
        padding: 4px; 
    }
</style>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.12.0/toastify.min.js"></script>

<script>

//deleting cart
//
// /  ending deleting cart
function deleteCart(id) {
    swal.fire({
        title: "Remove this item?",
        showCancelButton: true,
        confirmButtonColor: "#3085d6",
        cancelButtonColor: "#d33",
        confirmButtonText: "Yes, delete it!",
        customClass: {
            popup: 'swal-custom',
            content: 'swal-custom-content',
            confirmButton: 'swal-custom-confirm'
        }
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/deleteCart/${id}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    // Remove the item from the DOM
                    document.getElementById(`productRow_${id}`).remove();

                    // Show success toast
                    Toastify({
                        text: result.msg,
                        duration: 3000,
                        close: true,
                        gravity: "top",
                        position: 'right',
                        backgroundColor: "linear-gradient(to right, #00b09b, #96c93d)",
                        offset: {
                            x: 50,
                            y: 60
                        },
                        className: "toastify-custom"
                    }).showToast();

                    // Update the subtotal and grand total
                    updateTotals();
                } else {
                    console.error('Failed to delete item:', result.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    });
}
// /  ending deleting cart




 // Function to update quantity in backend
 function updateQuantity(productId, quantity, stockQuantity) {
    console.log("productId", productId);
    console.log("quantity", quantity);
    console.log("stockQuantity",stockQuantity);

    const quantityInput = document.getElementById(`qty_${productId}`);
    console.log("quantityInputtttttttt",quantityInput);
    if (quantity >= 10) {
        console.log("Limit exceeded");
        quantityInput.value = 10;

        Toastify({
            text: "this is the maximum limit",
            duration: 3000,
            close: true,
            gravity: "top",
            position: "center",
            backgroundColor:'#71cd14'
        }).showToast();
        return;
    } 
    console.log("Checking stock limit...");
    console.log("stockQuantity == quantity:", stockQuantity == quantity);
     if (quantityInput.value == stockQuantity) {
        console.log("Reached stock limittttttttttttttttttttttttttttttttttttt");
        quantityInput.value = quantity;
        
        Toastify({
            text: "Product Quantity is over",
            duration: 3000,
            close: true,
            gravity: "top",
            position: "center",
            backgroundColor:' #71cd14'
        }).showToast();
        return;
    }

    fetch(`/updateCart/${productId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ quantity: 1})
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            location.reload();
        } else {
            console.error('Failed to update quantity:', result.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

// Function to handle quantity change event
function handleQuantityChange(productId) {
    const newQuantity = document.getElementById(`qty_${productId}`).value;
    updateQuantity(productId, newQuantity);
}



//send in backened quentyty

//decrese botton
function decreaseButton(productId,quantity) {

    const quantityInput = document.getElementById(`qty_${productId}`);

    if(quantity<=1){
            console.log("ehti evde mone");
            Toastify({
            text: "Zero is not possible",
            duration: 3000,
            close: true,
            gravity: "top",
            position: "right",
            backgroundColor: "linear-gradient(to right, #ff5f6d, #ffc371)"
        }).showToast();
        return;
    }


    console.log("productId",productId);
            fetch(`/decreseBotton/${productId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ quantity: -1 }) 
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                       location.reload()
                } else {
                    // Handle error if needed
                    console.error('Failed to update quantity:', result.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
}

function handleQuantityChange(productId) {
    const newQuantity = document.getElementById(`qty_${productId}`).value;
    decreaseButton(productId, newQuantity);
}
///botton descerse


   
</script>

<script>
  var modal = document.getElementById("couponModal");

// Set the initial display to none
modal.style.display = 'none';

// Get the button that opens the modal
var btn = document.getElementById("CouponModal");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal
btn.onclick = function() {
  modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
</script>



<%- include('footer') %>
</body>

</html>
