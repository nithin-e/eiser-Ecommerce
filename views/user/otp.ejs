
   
   <!DOCTYPE html>
   <html lang="en">
   <head>
       <meta charset="UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <title>OTP Verification | Your Company</title>
       <link rel="stylesheet" href="/css/otp.css">
       <link rel="preconnect" href="https://fonts.googleapis.com">
       <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
       <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
      
       <style>
           .error-message {
               color: red;
               text-align: center;
               margin: 10px 0;
           }
       </style>
   </head>
   <body>
       <div class="container">
           <div class="otp-card">
               <h1>OTP Verification</h1>
               <% if (locals.errMess) { %>
                   <div class="error-message"><%= errMess %></div>
               <% } %>
               <div id="timer">02:00</div>
               <p>An OTP has been sent to <span class="email">ur mail</span>. Please enter it below to verify your email.</p>
               <form id="verifyOtpForm" action="/verify-otp" method="POST" class="otp-form">
                   <div class="otp-input-group">
                       <label for="otp">OTP:</label>
                       <div class="otp-inputs">
                           <input type="text" id="otp1" name="otp1" maxlength="1" required>
                           <input type="text" id="otp2" name="otp2" maxlength="1" required>
                           <input type="text" id="otp3" name="otp3" maxlength="1" required>
                           <input type="text" id="otp4" name="otp4" maxlength="1" required>
                       </div>
                   </div>
                   <div class="otp-actions">
                       <button type="submit" class="otp-btn otp-btn-primary">Verify OTP</button>
                   </div>
               </form>
               <form id="resendOtpForm" action="/resend-otp" method="POST">
                   <button id="resendOtpButton" type="button" class="otp-btn otp-btn-secondary" disabled>Resend OTP</button>
               </form>
           </div>
       </div>
   
       <script>
       document.addEventListener("DOMContentLoaded", function () {
           const email = "ur_mail@example.com"; // Replace with actual email or retrieve dynamically
           let timeLeft = localStorage.getItem(email) ? parseInt(localStorage.getItem(email)) : 120;
           const timerElement = document.getElementById("timer");
           const verifyButton = document.querySelector('.otp-btn-primary');
           const resendButton = document.getElementById("resendOtpButton");
           const otpInputs = document.querySelectorAll(".otp-inputs input");
   
           otpInputs.forEach((input, index) => {
               input.addEventListener("input", function () {
                   this.value = this.value.replace(/\D/g, "");
                   if (this.value.length === 1 && index < otpInputs.length - 1) {
                       otpInputs[index + 1].focus();
                   }
               });
   
               input.addEventListener("keydown", function (e) {
                   if (e.key === "Backspace" && this.value.length === 0 && index > 0) {
                       otpInputs[index - 1].focus();
                   }
               });
           });
   
           const updateTimer = () => {
               const minutes = Math.floor(timeLeft / 60).toString().padStart(2, "0");
               const seconds = (timeLeft % 60).toString().padStart(2, "0");
               timerElement.textContent = `${minutes}:${seconds}`;
   
               if (timeLeft <= 0) {
                   clearInterval(timerInterval);
                   verifyButton.disabled = true;
                   resendButton.disabled = false; // Enable resend button here
                   localStorage.removeItem(email);
               }
   
               timeLeft -= 1;
               localStorage.setItem(email, timeLeft);
           };
   
           let timerInterval = setInterval(updateTimer, 1000);
           updateTimer();
   
           document.getElementById("verifyOtpForm").addEventListener("submit", function () {
               localStorage.setItem(email, timeLeft);
           });
   
           if (timeLeft <= 0) {
               localStorage.removeItem(email);
           }
   
           resendButton.addEventListener("click", async function (event) {
               event.preventDefault(); // Prevent default form submission
               if (!resendButton.disabled) {
                   resendButton.disabled = true; // Disable button immediately
                   clearInterval(timerInterval); // Clear existing timer
                   timeLeft = 120; // Reset timeLeft to 120 (2 minutes)
                   updateTimer(); // Update the timer display immediately
                   localStorage.setItem(email, timeLeft);
                   timerInterval = setInterval(updateTimer, 1000); // Restart timer
   
                   

                     
                   try {
                       const response = await fetch(`/resend-otp?email=${email}`, {
                           method: 'POST'
                       });
                       if (response.ok) {
                           verifyButton.disabled = false;
                       } else {
                           console.error("Failed to resend OTP");
                           resendButton.disabled = false; // Re-enable button if request fails
                       }
                   } catch (error) {
                       console.error("Error resending OTP:", error);
                       resendButton.disabled = false; // Re-enable button if there's an error
                   }
               }
           });
       });
       </script>
   </body>
   </html>
   





    <!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP Verification | Your Company</title>
    <link rel="stylesheet" href="/css/otp.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        .error-message {
            color: red;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="otp-card">
            <h1>OTP Verification</h1>
            <% if (locals.errMess) { %>
                <div class="error-message"><%= errMess %></div>
            <% } %>
            <div id="timer">02:00</div>
            <p>An OTP has been sent to <span class="email">ur mail</span>. Please enter it below to verify your email.</p>
            <form id="verifyOtpForm" action="/verify-otp" method="POST" class="otp-form">
                <div class="otp-input-group">
                    <label for="otp">OTP:</label>
                    <div class="otp-inputs">
                        <input type="text" id="otp1" name="otp1" maxlength="1" required>
                        <input type="text" id="otp2" name="otp2" maxlength="1" required>
                        <input type="text" id="otp3" name="otp3" maxlength="1" required>
                        <input type="text" id="otp4" name="otp4" maxlength="1" required>
                    </div>
                </div>
                <div class="otp-actions">
                    <button type="submit" class="otp-btn otp-btn-primary">Verify OTP</button>
                </div>
            </form>
            <form id="resendOtpForm" action="/resend-otp" method="POST">
                <button id="resendOtpButton" type="button" class="otp-btn otp-btn-secondary" disabled>Resend OTP</button>
            </form>
        </div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        const email = "ur_mail@example.com"; // Replace with actual email or retrieve dynamically
        let timeLeft = localStorage.getItem(email) ? parseInt(localStorage.getItem(email)) : 120;
        const timerElement = document.getElementById("timer");
        const verifyButton = document.querySelector('.otp-btn-primary');
        const resendButton = document.getElementById("resendOtpButton");
        const otpInputs = document.querySelectorAll(".otp-inputs input");

        otpInputs.forEach((input, index) => {
            input.addEventListener("input", function () {
                this.value = this.value.replace(/\D/g, "");
                if (this.value.length === 1 && index < otpInputs.length - 1) {
                    otpInputs[index + 1].focus();
                }
            });

            input.addEventListener("keydown", function (e) {
                if (e.key === "Backspace" && this.value.length === 0 && index > 0) {
                    otpInputs[index - 1].focus();
                }
            });
        });

        const updateTimer = () => {
            const minutes = Math.floor(timeLeft / 60).toString().padStart(2, "0");
            const seconds = (timeLeft % 60).toString().padStart(2, "0");
            timerElement.textContent = `${minutes}:${seconds}`;

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                verifyButton.disabled = true;
                resendButton.disabled = false; // Enable resend button here
                localStorage.removeItem(email);
            }

            timeLeft -= 1;
            localStorage.setItem(email, timeLeft);
        };

        let timerInterval = setInterval(updateTimer, 1000);
        updateTimer();

        document.getElementById("verifyOtpForm").addEventListener("submit", function () {
            localStorage.setItem(email, timeLeft);
        });

        if (timeLeft <= 0) {
            localStorage.removeItem(email);
        }

        resendButton.addEventListener("click", async function (event) {
            event.preventDefault(); // Prevent default form submission
            if (!resendButton.disabled) {
                resendButton.disabled = true; // Disable button immediately
                clearInterval(timerInterval); // Clear existing timer
                timeLeft = 120; // Reset timeLeft to 120 (2 minutes)
                updateTimer(); // Update the timer display immediately
                localStorage.setItem(email, timeLeft);
                timerInterval = setInterval(updateTimer, 1000); // Restart timer

                try {
                    const encodedEmail = encodeURIComponent(email);
                    const response = await fetch(`/resend-otp?email=${encodedEmail}`, {
                        method: 'POST'
                    });
                    if (response.ok) {
                        verifyButton.disabled = false;
                    } else {
                        console.error("Failed to resend OTP");
                        resendButton.disabled = false; // Re-enable button if request fails
                    }
                } catch (error) {
                    console.error("Error resending OTP:", error);
                    resendButton.disabled = false; // Re-enable button if there's an error
                }
            }
        });
    });
    </script>
</body>
</html> -->
