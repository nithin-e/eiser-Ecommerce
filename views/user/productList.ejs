<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All Products</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">


  <%- include('Header') %>
</head> 
<body>

  <section class="" style="margin-top: 210px;">
    <div class="container">
      <div class="row" style="margin: -70px;padding-bottom: 100px;">

        <div class="col-lg-3">
          <button class="btn btn-outline-secondary mb-3 w-100 d-lg-none" type="button" data-mdb-toggle="collapse"
            data-mdb-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
            aria-label="Toggle navigation">
            <span>Show filter</span>
          </button>

          <div class="collapse card d-lg-block mb-5" id="navbarSupportedContent">
            <div class="accordion" id="accordionPanelsStayOpenExample">

              <form id="filterForm"  >
                
                <div class="accordion-item">
                  <h2 class="accordion-header" id="headingCategory">
                    <button class="accordion-button text-dark bg-light" type="button" data-mdb-toggle="collapse"
                      data-mdb-target="#panelsStayOpen-collapseCategory" aria-expanded="true"
                      aria-controls="panelsStayOpen-collapseCategory">
                      Category
                    </button>
                  </h2>
                  <div id="panelsStayOpen-collapseCategory" class="accordion-collapse collapse show"
                    aria-labelledby="headingCategory">
                    <div class="accordion-body">
                      <div>
                        <% allCategories.forEach(category => { %>
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="CategoryCheckbox_<%= category.name %>" name="categories" value="<%= category.name %>" />
                          <label class="form-check-label" for="CategoryCheckbox_<%= category.name %>"><%= category.name %></label>
                        </div>
                        <% }) %>
                      </div>
                    </div>
                  </div>
                </div>
           
                 <div class="accordion-item">
                  <h2 class="accordion-header" id="headingBrands">
                      <button class="accordion-button text-dark bg-light" type="button" data-mdb-toggle="collapse"
                          data-mdb-target="#panelsStayOpen-collapseBrands" aria-expanded="true"
                          aria-controls="panelsStayOpen-collapseBrands">
                          Brands
                      </button>
                  </h2>
                  <div id="panelsStayOpen-collapseBrands" class="accordion-collapse collapse show"
                      aria-labelledby="headingBrands">
                      <div class="accordion-body">
                        <div>
                            <% products.forEach(brand => { %>
                            <% if (brand.brand && brand.brand.name) { %>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="brandCheckbox_<%= brand.brand.name %>" name="brands" value="<%= brand.brand.name %>" />
                                <label class="form-check-label" for="brandCheckbox_<%= brand.brand.name %>"><%= brand.brand.name %></label>
                            </div>
                            <% } %>
                            <% }) %>
                            <span class="badge badge-secondary float-end"></span>
                        </div>
                    </div>
                  </div>
              </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingThree">
                        <button class="accordion-button text-dark bg-light" type="button" data-mdb-toggle="collapse"
                            data-mdb-target="#panelsStayOpen-collapseThree" aria-expanded="false"
                            aria-controls="panelsStayOpen-collapseThree">
                            Price
                        </button>
                    </h2>
                    <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse show"
                        aria-labelledby="headingThree">
                        <div class="accordion-body">
                            <div class="range">
                                <input type="range" class="form-range" id="priceRange" 
                                    min="0" max="50000" oninput="updateMaxPrice()" />
                            </div>
                            <div class="row mb-3">
                                <div class="col-6">
                                    <p class="mb-0">Min</p>
                                    <div class="form-outline">
                                        <input type="number" id="minPrice" name="minPrice"
                                            class="form-control" value="0" readonly />
                                        <label class="form-label" for="minPrice">₹ 0</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <p class="mb-0">Max</p>
                                    <div class="form-outline">
                                        <input type="number" id="maxPrice" name="maxPrice"
                                            class="form-control" value="50000" readonly />
                                        <label class="form-label" for="maxPrice">₹ 50,000</label>
                                    </div>
                                </div>
                            </div>
                            <button type="submit"  id="filterProduct"  class="btn btn-white w-100 border border-secondary">Apply</button>
                        </div>
                    </div>
                </div>
            </form>
            </div>
          </div>
        </div>
        <div class="col-lg-9" style="border-top: 2px solid green;         max-width: 74%">

          
          <div class="search-container" style="margin-left: 700px; margin-top:8px;">
            <input type="text" id="searchInput" class="search-box" value="" placeholder="Search...">
          </div>


          <header class="d-sm-flex align-items-center border-bottom mb-4 pb-3" >
            <div class="ms-auto">
            </div>
          </header>


 
<style>
 @import url('https://fonts.googleapis.com/css?family=Roboto:400,500,700');
*
{
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Roboto', sans-serif;
}

a {
    text-decoration: none;
}

.product-card {
    margin-top: 13px;
    width: 300px;
    box-shadow: 0 2px 7px #dfdfdf;
    background: #fafafa;
}

.badge {
    position: absolute;
    left: 0;
    text-transform: uppercase;
    font-size: 13px;
    font-weight: 700;
    background: red;
    color: #fff;
    padding: 3px 10px;
}

.product-tumb {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 300px;
    padding: 50px;
    background: #f0f0f0;
    overflow: hidden;
}

.product-tumb img {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    display: block;
    margin: 0 auto;
}

.product-details {
    padding: 30px;
}

.product-catagory {
    display: block;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    color: #ccc;
    margin-bottom: 18px;
}

.product-details h4 a {
    font-weight: 500;
    display: block;
    margin-bottom: 18px;
    text-transform: uppercase;
    color: #363636;
    text-decoration: none;
    transition: 0.3s;
}

.product-details h4 a:hover {
    color: #fbb72c;
}

.product-details p {
    font-size: 15px;
    line-height: 22px;
    margin-bottom: 18px;
    color: #999;
}

.product-bottom-details {
    overflow: hidden;
    border-top: 1px solid #eee;
    padding-top: 20px;
}

.product-bottom-details div {
    float: left;
    width: 50%;
}

.product-price {
    font-size: 18px;
    color: #fbb72c;
    font-weight: 600;
}

.product-price small {
    font-size: 80%;
    font-weight: 400;
    text-decoration: line-through;
    display: inline-block;
    margin-right: 5px;
}

.product-links {
    text-align: right;
}

.product-links a {
    display: inline-block;
    margin-left: 5px;
    color: #e1e1e1;
    transition: 0.3s;
    font-size: 17px;
}

.product-links a:hover {
    color: #fbb72c;
}

.single-product {
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    transition: box-shadow 0.3s ease;
    margin-bottom: 15px;
}

.single-product:hover {
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}

.product-img {
    height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.product-img img {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    transition: transform 0.3s ease;
}

.product-img:hover img {
    transform: scale(1.05);
}

.p_icon {
    display: flex;
    justify-content: center;
    margin-top: 10px;
}

.p_icon a {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    margin-right: 5px;
    background-color: white;
    border-radius: 50%;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: background-color 0.3s ease, transform 0.3s ease;
}

.p_icon a:hover {
    background-color: #f8f8f8;
    transform: scale(1.1);
}

.p_icon a i {
    color: #333;
    font-size: 16px;
}

.products-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
}

.products-grid .single-product {
    background: #fff;
  
    border-radius: 10px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.products-grid .single-product:hover {
    transform: translateY(-10px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}
.offer-price {
  color: #ff4500; 
  font-size: 1.2em; 
  font-weight:100; 
  margin-left: 10px; 
}
</style>

<div class="products-grid">
  <% products.forEach(product => { %>
    <% if (product.status === true) { %>
      <div class="single-product position-relative">
        <div class="product-img">
          <img class="img-fluid w-100" src="<%= product.images[0] %>" alt="" />
          <div class="p_icon">
            <a href="/ViewProduct/<%= product._id %>">
              <i class="ti-eye"></i>
            </a>
            <a href="#">
              <i class="ti-heart"></i>
            </a>
            <a href="#">
              <i class="ti-shopping-cart"></i>
            </a>
          </div>
        </div>
        <div class="product-btm">
          <a href="#" class="d-block">
            <h4><%= product.productName %></h4>
          </a>
          <div style="display: flex;">
            <div class="mt-3">
              <span 
                style="font-size: 16px; font-weight: 500; color:gray; <% if (product.offerPrice) { %> text-decoration: line-through; text-decoration-color: green;<% } %>" 
                class="single-price">
                ₹<%= product.price %>&nbsp;&nbsp;
              </span>
            </div>
            <% if (product.offerPrice) { %>
              <div class="mt-3">
                <span style="color:green;font-size: 14px;" class="offer-price">₹<%= product.offerPrice %></span>
              </div>
            <% } %>
          </div>
        </div>
        <!-- Badge positioned at the bottom left -->
         <% if (product.stockQuantity==0) { %>
          <div
          class="bg-danger rounded text-white position-absolute end-0 bottom-0 m-2 py-1 px-2"
          style="font-size: 0.75rem;"
        >
          OutOf 
        </div>
         <% } else if(product.stockQuantity<10){ %>
          <div
          class="bg-warning rounded text-dark position-absolute end-0 bottom-0 m-2 py-1 px-2"
          style="font-size: 0.75rem;"
        >
          Limited
        </div>
          <% }else{ %>
            <div
            class="bg-success rounded text-white position-absolute end-0 bottom-0 m-2 py-1 px-2"
            style="font-size: 0.75rem;"
          >
            In Stock
          </div>
          <% } %>
      </div>
    <% } %>
  <% }) %>
</div>





<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center">
    <% if (current > 1) { %>
      <li class="page-item">
        <a class="page-link" href="?page=<%= current - 1 %>">Previous</a>
      </li>
    <% } else { %>
      <li class="page-item disabled">
        <a class="page-link" href="#">Previous</a>
      </li>
    <% } %>

    <% for (let i = 1; i <= pages; i++) { %>
      <li class="page-item <%= current == i ? 'active' : '' %>">
        <a class="page-link" href="?page=<%= i %>"><%= i %></a>
      </li>
    <% } %>

    <% if (current < pages) { %>
      <li class="page-item">
        <a class="page-link" href="?page=<%= current + 1 %>">Next</a>
      </li>
    <% } else { %>
      <li class="page-item disabled">
        <a class="page-link" href="#">Next</a>
      </li>
    <% } %>
  </ul>
</nav>
</div>
</div>
</div>
</div>
</div>
</section>

             
   


  <script>
    function updateMaxPrice() {
      const priceRange = document.getElementById('priceRange');
      const maxPriceInput = document.getElementById('maxPrice');
      maxPriceInput.value = priceRange.value;
      updateLabel(maxPriceInput);
    }
    function updateLabel(input) {
      const label = document.querySelector(`[for="${input.id}"]`);
      label.textContent = `₹ ${input.value}`;
    }
    </script>
   
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script>
    function confirmLogout() {
        Swal.fire({
            title: 'Are you sure you want to logout?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, logout!',
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = '/logout';
            }
        });
    }
</script>
<script>
  function toggleView(view) {
    if (view === 'listView') {
      document.getElementById('gridViewSection').style.display = 'none';
      document.getElementById('listViewSection').style.display = 'block';
    } else {
      document.getElementById('gridViewSection').style.display = 'block';
      document.getElementById('listViewSection').style.display = 'none';
    }
  }
</script>



<script>
document.getElementById('filterProduct').addEventListener('click', function (event) {
event.preventDefault()

  // Get selected categories
  let category = [];
  document.querySelectorAll('input[name="categories"]:checked').forEach((checkbox) => {
    category.push(checkbox.value);
  });

  // Get selected brands
  let brand = [];
  document.querySelectorAll('input[name="brands"]:checked').forEach((checkbox) => {
    brand.push(checkbox.value);
  });

  // Get price range
  let minPrice = document.getElementById('minPrice').value;
  let price = document.getElementById('maxPrice').value;

  const data = new URLSearchParams({
    brand,
    category,
    price
  });

  fetch(`/filterProduct?${data.toString()}`, {
    method: 'GET',
    headers: {
      'Content-Type': 'application/json'
    },
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok ' + response.statusText);
    }
    return response.json();
  })
  .then(data => {
    if (data.success) {
      renderProducts(data.products);
    } else {
      console.error('Error in response data:', data);
    }
  })
  .catch(error => {
    console.error('Fetch error:', error);
  });
});

function renderProducts(products) {
  const productsGrid = document.querySelector('.products-grid');
  productsGrid.innerHTML = ''; // Clear the current products

  if (products.length === 0) {
    productsGrid.innerHTML = `
      <div class="no-products">
        <p>No products found</p>
      </div>
    `;
    return;
  }

  products.forEach(product => {
    if (product.status === true) {
      const productHTML = `
        <div class="single-product">
          <div class="product-img">
            <img class="img-fluid w-100" src="${product.images[0]}" alt="" />
            <div class="p_icon">
              <a href="/ViewProduct/${product._id}">
                <i class="ti-eye"></i>
              </a>
              <a href="#">
                <i class="ti-heart"></i>
              </a>
              <a href="#">
                <i class="ti-shopping-cart"></i>
              </a>
            </div>
          </div>
          <div class="product-btm">
            <a href="#" class="d-block">
              <h4>${product.productName}</h4>
            </a>
            <div style="display: flex;">
              <div class="mt-3">
                <span 
                  style="font-size: 16px; font-weight: 500; color:gray; ${product.offerPrice ? 'text-decoration: line-through; text-decoration-color: green;' : ''}" 
                  class="single-price">
                  ₹${product.price}&nbsp;&nbsp;
                </span>
              </div>
              ${product.offerPrice ? `
                <div class="mt-3">
                  <span style="color:green;font-size: 14px;" class="offer-price">₹${product.offerPrice}</span >
                </div>
              ` : ''}
            </div>
          </div>
        </div>
      `;
      productsGrid.innerHTML += productHTML;
    }
  });
}

</script>
  <style>
    .no-products {
  text-align: center;
  margin-top: 50px;
  font-size: 24px;
  font-weight: bold;
  color:gray;
  /* background-color: #f8f9fa; */
  padding: 20px;
  border-radius: 5px;
  margin-left: 400px;
}

.no-products p {
  margin: 0;
  padding: 0;
}
  </style>
  
  <script>
 function getInputValue() {
    var inputElement = document.getElementById('searchInput');
    var inputValue = inputElement.value; 

    const data = new URLSearchParams({
        inputValue
    });

    fetch(`/SearchProduct?${data.toString()}`, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())  
    .then(response => {
        if (response.success) {
          displayProducts(response.products);
        }
    })
    .catch(error => {
        console.error('Error:', error);  
    });
}
document.getElementById('searchInput').addEventListener('input', getInputValue);

function displayProducts(products) {
  
  const productsGrid = document.querySelector('.products-grid');
  productsGrid.innerHTML = ''; // Clear the current products

  if (products.length === 0) {
    productsGrid.innerHTML = `
      <div class="no-products">
        <p>No products found</p>
      </div>
    `;
    return;
  }

  products.forEach(product => {
    if (product.status === true) {
      const productHTML = `
        <div class="single-product">
          <div class="product-img">
            <img class="img-fluid w-100" src="${product.images[0]}" alt="" />
            <div class="p_icon">
              <a href="/ViewProduct/${product._id}">
                <i class="ti-eye"></i>
              </a>
              <a href="#">
                <i class="ti-heart"></i>
              </a>
              <a href="#">
                <i class="ti-shopping-cart"></i>
              </a>
            </div>
          </div>
          <div class="product-btm">
            <a href="#" class="d-block">
              <h4>${product.productName}</h4>
            </a>
            <div style="display: flex;">
              <div class="mt-3">
                <span 
                  style="font-size: 16px; font-weight: 500; color:gray; ${product.offerPrice ? 'text-decoration: line-through; text-decoration-color: green;' : ''}" 
                  class="single-price">
                  ₹${product.price}&nbsp;&nbsp;
                </span>
              </div>
              ${product.offerPrice ? `
                <div class="mt-3">
                  <span style="color:green;font-size: 14px;" class="offer-price">₹${product.offerPrice}</span >
                </div>
              ` : ''}
            </div>
          </div>
        </div>
      `;
      productsGrid.innerHTML += productHTML;
    }
  });
}

 
  </script>


</body>
</html>

<%- include('footer') %>

